<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>ML Model ‚Ä¢ Agentic RAG</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg sticky-top px-3">
        <a class="navbar-brand text-white fw-bold" href="/">üìä Agentic RAG</a>
        <div class="ms-auto d-flex align-items-center">
            <a href="/" class="nav-link text-white">Home</a>
            <a href="/upload" class="nav-link text-white">Upload File</a>
            <a href="/query" class="nav-link text-white">Ask Question</a>
            <a href="/visuals" class="nav-link text-white">Visuals</a>
            <!-- === ML EXTENSION: NAV LINK START === -->
            <a href="/ml" class="nav-link text-white active-link">ML</a>
            <!-- === ML EXTENSION: NAV LINK END === -->
        </div>
    </nav>

    <div class="container mt-4">
        {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
        {% endif %}

        <div class="row g-4">
            <!-- Train model -->
            <div class="col-md-6">
                <div class="card p-4">
                    <h3 class="mb-3">1Ô∏è‚É£ Train model from Excel/CSV</h3>
                    {% if not columns %}
                    <p class="text-muted">No tabular file available. Please upload an Excel/CSV file on the Home page.
                    </p>
                    {% else %}
                    <form method="post">
                        <input type="hidden" name="action" value="train">
                        <div class="mb-3">
                            <label class="form-label">Target column</label>
                            <select name="target_column" class="form-select" required>
                                {% for col in columns %}
                                <option value="{{ col }}">{{ col }}</option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">
                                This is the column you want the model to predict.
                            </small>
                        </div>
                        <button type="submit" class="btn btn-primary">Train model</button>
                    </form>
                    {% endif %}

                    {% if train_text %}
                    <hr>
                    <h5>Training result</h5>
                    <p class="mb-1">{{ train_text }}</p>
                    {% if model_id %}
                    <p class="mb-0"><small class="text-muted">Model ID: {{ model_id }}</small></p>
                    {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- Predict -->
            <div class="col-md-6">
                <div class="card p-4">
                    <h3 class="mb-3">2Ô∏è‚É£ Predict for a similar case</h3>
                    {% if not model_id %}
                    <p class="text-muted">Train a model first, then you can make predictions here.</p>
                    {% elif not feature_schema %}
                    <p class="text-muted">Train a model again to load feature fields.</p>
                    {% else %}
                    <p class="text-muted mb-2">
                        Target: <strong>{{ feature_schema.target }}</strong>
                    </p>
                    <form method="post">
                        <input type="hidden" name="action" value="predict">
                        <div class="row g-3">
                            {% for col_name, ftype in feature_schema.features.items() %}
                            <div class="col-12">
                                <label class="form-label">
                                    {{ col_name }}
                                    {% if ftype == "numeric" %}
                                    <span class="badge bg-light text-dark ms-1">number</span>
                                    {% else %}
                                    <span class="badge bg-light text-dark ms-1">text</span>
                                    {% endif %}
                                </label>
                                {% if ftype == "numeric" %}
                                <input type="number" step="any" class="form-control" name="feat_{{ col_name }}"
                                    placeholder="Enter number">
                                {% else %}
                                <input type="text" class="form-control" name="feat_{{ col_name }}"
                                    placeholder="Enter text">
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        <button type="submit" class="btn btn-success mt-3">Predict</button>
                    </form>
                    {% endif %}

                    {% if predict_text %}
                    <hr>
                    <h5>Prediction (plain text)</h5>
                    <p class="fs-5"><strong>{{ predict_text }}</strong></p>
                    {% endif %}

                    {% if predict_result %}
                    <h6 class="mt-3">Details (JSON)</h6>
                    <pre style="white-space: pre-wrap;">{{ predict_result | tojson(indent=2) }}</pre>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>